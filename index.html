<!DOCTYPE html>
<html lang="en-US">
<head>
	<title>Taxi109</title>
	<meta charset="UTF-8">
	<meta name="description" content="CS109 Final Project, December 2015">
	<meta name="keywords" content="taxi, data, science, CS109, tipping, cash, credit">
	<meta name="author" content="Alex Orlov, Kristen Faulkner, Hugh Zabriskie, and Stefan Rajkovic">

	<!-- CSS -->
	<link rel="stylesheet" href="taxi109.css">

	<!-- LaTeX -->
	<script type="text/javascript" src="http://latex.codecogs.com/latexit.js"></script>

</head>

<body>
<!-- Facebook share button -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="container">
	<nav>
		<ul class="bar">
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
		</ul>
		<span id="nav-title">Taxi #109</span>
		<span id="nav-link"><a href="https://github.com/AOrlov8957/CS109FinalProject" target="_blank">
			Notebook
			<img src="images/github.png">
			</a>
		</span>
		<ul class="bar">
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
		</ul>
		<ul id="nav-menu">
			<li>Data <!--- the lack of </li> here is important! -->
				<div class="wrapper">
						<div class="dropdown blue">
							<div class="margin-wrapper">
								<div class="img-wrapper" style="background-image:url('images/money.jpg')"></div>
								<h4>Visualizing the data</h4>
								<hr>
								<p>Here we describe initial visualzations and discuss common patterns in NYC taxicab life.</p>
							</div>
						</div>
				</div>
			<li>The Art of Tipping
				<div class="wrapper">
						<div class="dropdown yellow">
							<div class="margin-wrapper">
								<div class="img-wrapper" style="background-image:url('images/money.jpg')"></div>
								<h4>The Art of Tipping</h4>
								<hr>
								<p>Here we describe initial visualzations and discuss common patterns in NYC taxicab life.</p>
							</div>
						</div>
				</div>
			<li>Underreported Tips
				<div class="wrapper">
						<div class="dropdown blue">
							<div class="margin-wrapper">
								<div class="img-wrapper" style="background-image:url('images/money.jpg')"></div>
								<h4>What cab drivers don't tell you about cash tips</h4>
								<hr>
								<p>Here we describe initial visualzations and discuss common patterns in NYC taxicab life.</p>
							</div>
						</div>
				</div>
			<li>Where do riders tip?
				<div class="wrapper">
						<div class="dropdown yellow">
							<div class="margin-wrapper">
								<div class="img-wrapper" style="background-image:url('images/money.jpg')"></div>
								<h4>High and low tip zones, where they are</h4>
								<hr>
								<p>Here we describe initial visualzations and discuss common patterns in NYC taxicab life.</p>
							</div>
						</div>
				</div>
			<li>Conclusions
				<div class="wrapper">
						<div class="dropdown blue">
							<div class="margin-wrapper">
								<div class="img-wrapper" style="background-image:url('images/money.jpg')"></div>
								<h4>The big finds</h4>
								<hr>
								<p>Here we describe initial visualzations and discuss common patterns in NYC taxicab life.</p>
							</div>
						</div>
				</div>
		</ul>
	</nav>

	<div id="title">
		<div class="wrapper">
			<img src="images/cover.jpg" id="cover-photo">
			<div class="center-banner">
				<h1>Taxi #109</h1>
				<h3>A data science project based on NYC Yellow Cab Data, 2013-2015</h3>
				<h4>By Kristen Faulkner, Alex Orlov, Stefan Rajkovic, and Hugh Zabriskie</h4>
			</div>
		</div>
	</div>

	<div id="post-info">
		<div id="article-details">CS 109 | 11:59 PM | 10 December 2015</div>
		<ul id="article-links">
			<li><a href="javascript:window.print()"><img src="images/printer.png" alt="Print article."/></a></li>
			<li><div class="fb-share-button" data-href="http://aorlov8957.github.io/CS109FinalProject/" data-layout="button_count"></div></li>
			<li><a href="https://github.com/AOrlov8957/CS109FinalProject">
				<img src="images/github.png" alt="Share our code and notebook on Github!"/></a>
			</li>
		</ul>
	</div>

	<!-- Main entry content !-->
	<div id="entry-content">
		<h2>In recent years, the NYC Taxi & Limousine Commission has released a huge wealth of data about the city's taxi business.
			<br>And the data has a lot to say.
		</h2>
		<p>The huge data set, which was obtained through <a href="http://chriswhong.com/open-data/foil_nyc_taxi/">a request under Freedom of Information Act (FOIA)</a> by Chris Wong, is now publicly <a href="http://www.andresmh.com/nyctaxitrips/">available online</a> and the source of as many interesting data science projects as it is the subject of serious privacy concerns. The data contains <a href="http://www.nyc.gov/html/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf">detailed information</a> about every tip, including the exact coordinates of pickup and dropoff, an itemized fare breakdown, tip amount, and a hashed value to uniquely (but anonymously) idenitfy each taxi number and license plate.</p>
		<p>
		<p>Unfortunately, the data was not anonymousized as much as officials may have thought, and <a href="https://medium.com/@vijayp/of-taxis-and-rainbows-f6bc289679a1#.e18hj56am">one blogger</a> was able to easily de-anonymize the hashed taxi data to reveal the original values. As a result, J.K. Trotter published an <a href="http://gawker.com/the-public-nyc-taxicab-database-that-accidentally-track-1646724546">article on Gawker</a> where he used the data to locate the exact rides taken by big name celebrities, like Bradley Cooper and Olivia Munn, after scraping the internet for timestamped photos of celebrities getting into taxis, the license plate and medallion number displayed on the side of the taxi in large black print for all to see. These projects have raised serious privacy concerns as it seems increasingly possible to link specific individuals to taxi trips they might take and would rather people not know about.</p>
		<p>However, less controversial articles have been published on the data. Nate Silver's blog FiveThirtyEight examined the <a href="http://fivethirtyeight.com/features/uber-is-taking-millions-of-manhattan-rides-away-from-taxis/">dataset in October</a> alongside Uber pickup data obtained via a separate FOIA request to the Taxi & Limousine Commission and disovered that Ubers were aggressively replacing taxis in the city at almost exactly a 1-to-1 ratio.</p>

		<p>For this project, our team decided to examine tipping behavior in the data, which includes about <em>173 million</em> individual taxi rides. For our initial experiments, we used a subset of data between 200K and 1M rows, but found that as we expanded the data set our results did not vary significantly. Our results and links to the data <a href="https://github.com/AOrlov8957/CS109FinalProject">are stored</a> in a Python Jupyter Notebook.</p>

		<br>
		<h2>To get a more visual sense of the data, we plotted the location of just the first million data points.</h2>

		<p>As a first step, we cleaned the data of extreme outliers and extraneous entries. The most common errors included trips with incorrect latitide/longitude coordinates for pickup and dropoff points, payments that seemed too high, and trips of length zero. We also removed taxi rides to airports (JFK, Newark, Nassau, or Westchester) because they are fixed rates - generally, $50. These trips distorted the correlation between features like fare amount, distance, and tip amount.</p>
		<p>Using Python's Basemap library, we displayed the pickup and dropoff points for a single medallion in our first million data points. This only includes trips over a time period of about 28 hours, starting at January 1st, 2013 4:41 PM.</p>

		<div class="figure">
			<img src="images/onetaxi.png" alt="Figure: the trips for one taxi between 1/13/13 4:41PM and 1/14/13 8:58PM." />
		</div>

		<p>And here is a map of the first 200,000 pickups points in the NYC area between January 1st and January 20th.</p>

		<div class="figure">
			<img src="images/pickup_init.png" alt="Figure: the trips for one taxi between 1/13/13 4:41PM and 1/14/13 8:58PM." />
		</div>

		<h2>The reality about paying with cash is that taxi drivers rarely report the tip when you do.</h2>

		<p>Of the 453,000 rides paid for in cash in our first million data points, only 11 reported a tip. This means that either riders who pay with cash are exceptionally stingy, or more likely those tips are not being reported. This seems particularly unusual when compared to trips where the rider paid with credit card, which had a 97% tipping rate.</p>

		<table class="table">
		  <caption>Tipping behavior for the first 1,000,000 data points</caption>
		  <tr>
		  	<th>Payment Type</th>
		  	<th>Total Riders</th>
		  	<th>Did Tip</th>
		  	<th>Did Tip (%)</th>
		  	<th>Did Not Tip</th>
		  	<th>Did Not Tip (%)</th>
		  <tr>
		    <td class="uppercase">Cash</td>
		    <td class="numerical">453600</td>
		    <td class="numerical">11</td>
		    <td class="numerical">0.0024%</td>
		    <td class="numerical">453.6K</td>
		    <td class="numerical">99.9976%</td>
		  </tr>
		  <tr>
		    <td class="uppercase">Credit</td>
		    <td class="numerical">525704</td>
		    <td class="numerical">507867</td>
		    <td class="numerical">96.61%</td>
		    <td class="numerical">17837</td>
		    <td class="numerical">3.39%</td>
		  </tr>
		</table>

		<p>It turns out that underreporting cash tips is a <a href="http://www.bloomberg.com/bw/articles/2014-07-31/heres-how-much-you-should-be-tipping-your-cab-driver%20">well-known phenomenon</a>. Taxi drivers, like everyone else, must report their income and pay taxes on it - including taxes on tips. Drivers are therefore incentivized to pocket cash tips rather than report them and incur additional taxes.</p>

		<p>We then asked a follow-up question: if all of tips for rides paid in cash are going unreported and the IRS is not collecting taxes on that revenue, then exactly how much <em>is</em> the IRS losing in terms of revenue? A baseline approach is to find the average tip percentage across all rides paid for by credit card and then made a sum across all fare amount from cash trips times the average tip percentage.</p>

		<div lang="latex" class="center">R = \hat{y} \sum_{f_{CSH}} {f_{CSH}}</div>
		<p>where <span lang="latex">f_{CSH}</span> is the fare amount from a taxi ride paid for in cash, <span lang="latex">\hat{y}</span> is the average tip percentage across all tips paid with credit card. This baseline model suggests <span lang="latex">R</span>, or the unreported revenue is about $863,812.25 for the first million rides. Note that this excludes airport trips, which as we discussed earlier created a significant distortion in our data on tips. The baseline suggests then, on average, $0.86 of revenue goes unreported in each taxi ride. And given that there were about 175 million taxi ride in 2013, and that roughly 46% were paid for in cash in the first million data points.</p>

		<br>
		<p> We also picked up some features about tipping behavior. Below is a histogram that shows tipping by time of day. As we can see from the graph, the largest tips tend to occur at night between 8pm-1am, and the smallest tips occur in the morning between 6-7am.</p>

		<div class="figure">
			<img src="images/tip_by_hour.jpg" alt="Figure: shows average tip percentage for each hour of the day." />
		</div>

		<p>And, maybe not so surprisingly, the largest amount of revenue for taxis comes during rush hours, which occur between 7-8am and 5-6pm.</p>

		<div class="figure">
			<img src="images/revenue_by_hour.jpg" alt="Figure: shows average revenue for each hour of the day." />
		</div>

		<p>Finally, we discovered that the type of software used by the cab to process credit card payments actually has a significant impact on the resulting tip. Why? The CMT software includes surcharge and tolls in calculating the fare amount, which increases the tip. The VTS software, however, does not, resulting in lower average tips.</p>

		<table class="table">
		  <caption>Tipping behavior for the first 1,000,000 data points</caption>
		  <tr>
		  	<th>Vendor Software</th>
		  	<th>Average Tip</th>
		  <tr>
		    <td class="uppercase">cmt</td>
		    <td class="numerical">19.6%</td>
		  </tr>
		  <tr>
		    <td class="uppercase">vts</td>
		    <td class="numerical">10.6%</td>
		  </tr>
		</table> 

		<h2>Creating an accurate model to predict tips for cash transactions turns out to be a daunting proposition.</h2>

		<p>We started by trying to estimate the tip amounts for any given ride using an Ordinary Least Squares Regression (OLS). The assumption here is that the data has displays linear correlation between variables. While we knew that this was most likely not the case, we decided to try it anyway as a first attempt at refining our baseline model. We regressed tip percent against the seven variables that described trips; fare amount, passenger count, trip time, payment type, pickup latitude, pickup longitude, and time of day. Our results were unabashedly abysmal. With an <span lang="latex">R^2</span> of <span lang="latex">0.028</span> and most variables having a <span lang="latex">p</span> value that rendered them statistically insignificant, we quickly gave up on a linear fit and moved on to bigger and better methods.</p>

		<p>k-Nearest Neighbors classification was our next idea. k-NN is a relatively simple machine learning algorithm, and it works by classifying all known data points in a discrete number of classes and then classifying future data points based on the <span lang="latex">k</span> nearest known data points (i.e. the "neighbors"). With respect to taxis, this means we can classify rides based on similar ones.</p>

		<p>Below is a series kernel density estimation (KDE) plots that displays the relative density of data points in each class. Here, we used 7 classes (<span lang="latex">k=7</span>) where each class is an interval of 5% tip amount. Class 0, for example, contains all tips between 0 and 5%, and class 6 contains all tips above 30%. The heavy overlap shows us most of the features are not strong predictors of how people will tip. The only exceptions seem to be "trip time in seconds" and "fare amount", but they are not statistically significant enough to be strong differentiators.</p>

		<div class="figure">
			<img src="images/KDE_kNN.png" alt="Figure: kernel density estimators for KNN." />
		</div>

		<br>
		<h2>The last method we tried to use to predict tip amount from our features was an artificial neural network.</h2>
		<p>An artifical neural network (ANN) learns to correlate a feature space with a discrete set of output classes. These types of networks have become extremely popular in machine learning in recent decades, and they have demonstrated their effectiveness on tasks ranging from image recognition and anomaly detection to signal processing and language translation. We chose the neural network since itâ€™s an advanced machine learning technique that can handle the number of features we have and the size of data we have, and create a good estimator. Our neural network provided the best estimator we had, beating our baseline by about 5% accuracy, and providing a more accurate estimate on the card data when the baseline did.</p>


	</div> <!--- entry-content -->

	<div id="footer">
		<div class="authors">Made by Hugh Zabriskie, Stefan Rajkovic, Alex Orlov, Kristen Faulkner</div>
		<div>&copy; Zabriskie, Rajkovic, Orlov, Faulkner 2015</div>
	</div>

</div>

</body>

</html>
